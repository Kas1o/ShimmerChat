@inherits LayoutComponentBase
@implements IDisposable
@inject NavigationManager NavigationManager

<div class="shimmer-layout">
    <!-- ä¾§è¾¹å¯¼èˆªæ  -->
    <aside class="shimmer-sidebar">
        <NavMenu />
    </aside>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="shimmer-main">

        <!-- å†…å®¹åŒºåŸŸ -->
        <article class="shimmer-content">
            @Body
        </article>
    </main>
</div>

<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">ğŸ—™</span>
</div>

<ShimmerChat.Components.SubComponents.PopupMessageBox/>


<style>
    .shimmer-layout {
        display: flex;
        height: 100vh;
        width: 100vw;
        overflow: hidden;
    }

    .shimmer-main {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        background-color: var(--color-background);
    }

    .shimmer-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        overflow-x: hidden;
    }
</style>
@code {
    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            // åˆå§‹åŒ–é”™è¯¯UIäº‹ä»¶å¤„ç†
            InitializeErrorHandlers();
        }
    }

    private void InitializeErrorHandlers()
    {
        // è¿™é‡Œå¯ä»¥æ·»åŠ JavaScriptäº’æ“ä½œæ¥å¤„ç†é”™è¯¯UIçš„äº‹ä»¶
    }

    private string currentPath = "";

    protected override void OnInitialized()
    {
        // è®¢é˜…å¯¼èˆªäº‹ä»¶
        NavigationManager.LocationChanged += OnLocationChanged;
        currentPath = NavigationManager.Uri;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentPath = e.Location; // æˆ–ä½¿ç”¨ NavigationManager.ToBaseRelativePath(e.Location)
        Console.WriteLine(currentPath);
    }

    public void Dispose()
    {
        // é¿å…å†…å­˜æ³„æ¼ï¼Œå–æ¶ˆè®¢é˜…
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}

