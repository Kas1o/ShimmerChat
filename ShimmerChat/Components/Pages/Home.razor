@page "/"
@using System.Timers
@using ShimmerChat.Singletons
@inject IThemeService ThemeService
@implements IDisposable
<div id="bg-region" style="background-image: url('@BackgroundImagePath')">
	<div id="main-content">
		<div id="title">
			SHIMMER CHAT
		</div>
		<div id="time">
			<p>@currentTime</p>
		</div>
	</div>

</div>
<style>
	#bg-region{
	display: flex;
	justify-content: center; /* 水平居中 */
	align-items: center; /* 垂直居中 */
	width: 100%;
	height: 800px; /* 视窗高度的100%，使得div覆盖整个视窗 */
	background-size: cover;
	background-position: center;
	position: relative;

	}
	/* 中间的大号粗体字的样式 */
	#main-content {
	position: absolute; /* 子元素绝对定位，基于最近的相对定位祖先 */
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	color: white; /* 字体颜色 */
	font-size: 6em; /* 调整字体大小 */
	font-weight: bold;
	text-shadow: 8px 4px 16px #00000099;
	font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	}
	#time{
	font-size: 30px;
		text-shadow: 3px 2px 8px #00000099;
	}
</style>

@code {
	private string currentTime = DateTime.Now.ToString("T");
	private Timer timer;
	private string BackgroundImagePath => ThemeService.IsDarkMode ? "/shimmer-chat-bg.png" : "/shimmer-chat-bg-light-theme.png";

	protected override void OnInitialized()
	{
		// 每隔一秒更新一次时间
		timer = new Timer(1000);
		timer.Elapsed += UpdateTime;
		timer.AutoReset = true;
		timer.Enabled = true;
		
		// 订阅主题变更事件
		ThemeService.OnThemeChanged += HandleThemeChanged;
	}
	
	private void HandleThemeChanged(bool isDarkMode)
	{
		// 触发组件重新渲染，更新背景图片
		InvokeAsync(StateHasChanged);
	}

	private void UpdateTime(object source, ElapsedEventArgs e)
	{
		currentTime = DateTime.Now.ToString("T");
		InvokeAsync(StateHasChanged); // 请求刷新 UI
	}

	public void Dispose()
	{
		// 停止计时器
		timer?.Stop();
		timer?.Dispose();
		
		// 取消订阅主题变更事件
		ThemeService.OnThemeChanged -= HandleThemeChanged;
	}
}
