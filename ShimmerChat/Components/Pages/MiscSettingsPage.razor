@page "/misc"

@inject IKVDataService KVData

<h3>MiscSettingsPage</h3>

<div class="shimmer-group">
	<h4>App Settings</h4>

	<input type="checkbox" class="form-check-input" id="throw-exception" @bind="_throwExceptionInsteadOfPopupErrorMessage" />
	<label class="form-check-label" for="throw-exception">Throw exception instead of popup error message</label>
</div>


<div class="shimmer-group">
	<h4>User Settings</h4>

	<label class="form-check-label" for="username">User Name</label>
	<input type="text" class="form-control" id="username" @bind="_UserName" />
</div>

@code {
	private bool _throwExceptionInsteadOfPopupErrorMessage
	{
		get => field;
		set
		{
			if (field == value) return;
			field = value;
			Save();
		}
	} = false;
	private string _UserName
	{
		get => field;
		set
		{
			if (field == value) return;
			field = value;
			Save();
		}
	} = "";



	bool Initialized = false;
	private void Save()
	{
		if (!Initialized) return;
		KVData.Write("App", "throw_exception", _throwExceptionInsteadOfPopupErrorMessage ? "true": "false");
		KVData.Write("User", "username", _UserName);
	}

	protected override void OnInitialized()
	{
		if(bool.TryParse(KVData.Read("App", "throw_exception"), out var result)){
			_throwExceptionInsteadOfPopupErrorMessage = result;
		}
		_UserName = KVData.Read("User", "username") ?? "";
		Initialized = true;
	}
}
